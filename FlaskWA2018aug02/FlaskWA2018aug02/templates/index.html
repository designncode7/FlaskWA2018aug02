{% extends "layout.html" %}

{% block content %}


<div class="jumbotron">
<h2> IoT Device Data: </h2>

<pre id="iotdata"></pre>
<div id="tester" style="width:600px;height:250px;"></div>
    <script>
        var source = new EventSource('/event_stream');
        source.onmessage = function (event) {
            console.log(event.data);
            var tempjson = String(event.data);
            tempjson = tempjson.substr(1);

            // Get indices of actual message
            var start = tempjson.indexOf("\'") + 1;
            var end = tempjson.lastIndexOf("}") + 1;
            var length = end - start;

            var cleanJsonString = tempjson.substring(start, length + 1);

            console.log(cleanJsonString);
            var myiotdata = JSON.parse(cleanJsonString);
            //alert(myiotdata.date);
            var iotdatadate = myiotdata.date;
            console.log(myiotdata.date);
            var iotdatapressure = myiotdata.pressure;
            console.log('pressure: ' + myiotdata.pressure);

            TESTER = document.getElementById('tester');

            Plotly.plot(TESTER, [{ x: iotdatapressure}],
                {
                    margin: { t: 0 }
                });

            /* Current Plotly.js version */
            console.log(Plotly.BUILD);

            document.getElementById("iotdata").innerHTML = cleanJsonString;

        };
    </script>

</div>

{% endblock %}
